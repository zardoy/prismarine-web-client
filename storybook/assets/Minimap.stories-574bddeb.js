var wn=Object.defineProperty;var bn=(e,i,n)=>i in e?wn(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n;var j=(e,i,n)=>(bn(e,typeof i!="symbol"?i+"":i,n),n);import{a as O,j as C}from"./jsx-runtime-37f7df21.js";import{g as Sn,R as V,r as m}from"./index-f1f2c4b1.js";import{B as U}from"./Button-171a86dd.js";import{I}from"./Input-38b084ae.js";import"./SharedHudVars-63c800bd.js";import"./PixelartIcon-62975882.js";import"./simpleUtils-f26d34af.js";const Cn=/\((-?[.\d]+), (-?[.\d]+), (-?[.\d]+)\)/;let q=class N{constructor(i,n,t){this.x=i,this.y=n,this.z=t}set(i,n,t){return this.x=i,this.y=n,this.z=t,this}update(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}rounded(){return new N(Math.round(this.x),Math.round(this.y),Math.round(this.z))}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}floored(){return new N(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}offset(i,n,t){return new N(this.x+i,this.y+n,this.z+t)}translate(i,n,t){return this.x+=i,this.y+=n,this.z+=t,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this}subtract(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this}plus(i){return this.offset(i.x,i.y,i.z)}minus(i){return this.offset(-i.x,-i.y,-i.z)}scaled(i){return new N(this.x*i,this.y*i,this.z*i)}abs(){return new N(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))}volume(){return this.x*this.y*this.z}modulus(i){return new N(de(this.x,i.x),de(this.y,i.y),de(this.z,i.z))}distanceTo(i){const n=i.x-this.x,t=i.y-this.y,r=i.z-this.z;return Math.sqrt(n*n+t*t+r*r)}distanceSquared(i){const n=i.x-this.x,t=i.y-this.y,r=i.z-this.z;return n*n+t*t+r*r}equals(i){return this.x===i.x&&this.y===i.y&&this.z===i.z}toString(){return"("+this.x+", "+this.y+", "+this.z+")"}clone(){return this.offset(0,0,0)}min(i){return new N(Math.min(this.x,i.x),Math.min(this.y,i.y),Math.min(this.z,i.z))}max(i){return new N(Math.max(this.x,i.x),Math.max(this.y,i.y),Math.max(this.z,i.z))}norm(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}cross(i){return new N(this.y*i.z-this.z*i.y,this.z*i.x-this.x*i.z,this.x*i.y-this.y*i.x)}unit(){const i=this.norm();return i===0?this.clone():this.scaled(1/i)}normalize(){const i=this.norm();return i!==0&&(this.x/=i,this.y/=i,this.z/=i),this}scale(i){return this.x*=i,this.y*=i,this.z*=i,this}xyDistanceTo(i){const n=i.x-this.x,t=i.y-this.y;return Math.sqrt(n*n+t*t)}xzDistanceTo(i){const n=i.x-this.x,t=i.z-this.z;return Math.sqrt(n*n+t*t)}yzDistanceTo(i){const n=i.y-this.y,t=i.z-this.z;return Math.sqrt(n*n+t*t)}innerProduct(i){return this.x*i.x+this.y*i.y+this.z*i.z}manhattanDistanceTo(i){return Math.abs(i.x-this.x)+Math.abs(i.y-this.y)+Math.abs(i.z-this.z)}toArray(){return[this.x,this.y,this.z]}};function xe(e,i,n){if(e==null)return new q(0,0,0);if(Array.isArray(e))return new q(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]));if(typeof e=="object")return new q(parseFloat(e.x),parseFloat(e.y),parseFloat(e.z));if(typeof e=="string"&&i==null){const t=e.match(Cn);if(t)return new q(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]));throw new Error("vec3: cannot parse: "+e)}else return new q(parseFloat(e),parseFloat(i),parseFloat(n))}function de(e,i){const n=e%i;return n<0?n+i:n}var Pn=xe;xe.Vec3=q;const zn=Sn(Pn),Re=zn.Vec3;var he={exports:{}},H=typeof Reflect=="object"?Reflect:null,Te=H&&typeof H.apply=="function"?H.apply:function(i,n,t){return Function.prototype.apply.call(i,n,t)},ie;H&&typeof H.ownKeys=="function"?ie=H.ownKeys:Object.getOwnPropertySymbols?ie=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:ie=function(i){return Object.getOwnPropertyNames(i)};function Tn(e){console&&console.warn&&console.warn(e)}var Be=Number.isNaN||function(i){return i!==i};function P(){P.init.call(this)}he.exports=P;he.exports.once=_n;P.EventEmitter=P;P.prototype._events=void 0;P.prototype._eventsCount=0;P.prototype._maxListeners=void 0;var Ye=10;function te(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(P,"defaultMaxListeners",{enumerable:!0,get:function(){return Ye},set:function(e){if(typeof e!="number"||e<0||Be(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Ye=e}});P.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};P.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||Be(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function Ze(e){return e._maxListeners===void 0?P.defaultMaxListeners:e._maxListeners}P.prototype.getMaxListeners=function(){return Ze(this)};P.prototype.emit=function(i){for(var n=[],t=1;t<arguments.length;t++)n.push(arguments[t]);var r=i==="error",o=this._events;if(o!==void 0)r=r&&o.error===void 0;else if(!r)return!1;if(r){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=o[i];if(l===void 0)return!1;if(typeof l=="function")Te(l,this,n);else for(var u=l.length,d=He(l,u),t=0;t<u;++t)Te(d[t],this,n);return!0};function Ve(e,i,n,t){var r,o,a;if(te(n),o=e._events,o===void 0?(o=e._events=Object.create(null),e._eventsCount=0):(o.newListener!==void 0&&(e.emit("newListener",i,n.listener?n.listener:n),o=e._events),a=o[i]),a===void 0)a=o[i]=n,++e._eventsCount;else if(typeof a=="function"?a=o[i]=t?[n,a]:[a,n]:t?a.unshift(n):a.push(n),r=Ze(e),r>0&&a.length>r&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=e,s.type=i,s.count=a.length,Tn(s)}return e}P.prototype.addListener=function(i,n){return Ve(this,i,n,!1)};P.prototype.on=P.prototype.addListener;P.prototype.prependListener=function(i,n){return Ve(this,i,n,!0)};function Yn(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Fe(e,i,n){var t={fired:!1,wrapFn:void 0,target:e,type:i,listener:n},r=Yn.bind(t);return r.listener=n,t.wrapFn=r,r}P.prototype.once=function(i,n){return te(n),this.on(i,Fe(this,i,n)),this};P.prototype.prependOnceListener=function(i,n){return te(n),this.prependListener(i,Fe(this,i,n)),this};P.prototype.removeListener=function(i,n){var t,r,o,a,s;if(te(n),r=this._events,r===void 0)return this;if(t=r[i],t===void 0)return this;if(t===n||t.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete r[i],r.removeListener&&this.emit("removeListener",i,t.listener||n));else if(typeof t!="function"){for(o=-1,a=t.length-1;a>=0;a--)if(t[a]===n||t[a].listener===n){s=t[a].listener,o=a;break}if(o<0)return this;o===0?t.shift():En(t,o),t.length===1&&(r[i]=t[0]),r.removeListener!==void 0&&this.emit("removeListener",i,s||n)}return this};P.prototype.off=P.prototype.removeListener;P.prototype.removeAllListeners=function(i){var n,t,r;if(t=this._events,t===void 0)return this;if(t.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):t[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete t[i]),this;if(arguments.length===0){var o=Object.keys(t),a;for(r=0;r<o.length;++r)a=o[r],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=t[i],typeof n=="function")this.removeListener(i,n);else if(n!==void 0)for(r=n.length-1;r>=0;r--)this.removeListener(i,n[r]);return this};function je(e,i,n){var t=e._events;if(t===void 0)return[];var r=t[i];return r===void 0?[]:typeof r=="function"?n?[r.listener||r]:[r]:n?Xn(r):He(r,r.length)}P.prototype.listeners=function(i){return je(this,i,!0)};P.prototype.rawListeners=function(i){return je(this,i,!1)};P.listenerCount=function(e,i){return typeof e.listenerCount=="function"?e.listenerCount(i):qe.call(e,i)};P.prototype.listenerCount=qe;function qe(e){var i=this._events;if(i!==void 0){var n=i[e];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}P.prototype.eventNames=function(){return this._eventsCount>0?ie(this._events):[]};function He(e,i){for(var n=new Array(i),t=0;t<i;++t)n[t]=e[t];return n}function En(e,i){for(;i+1<e.length;i++)e[i]=e[i+1];e.pop()}function Xn(e){for(var i=new Array(e.length),n=0;n<i.length;++n)i[n]=e[n].listener||e[n];return i}function _n(e,i){return new Promise(function(n,t){function r(a){e.removeListener(i,o),t(a)}function o(){typeof e.removeListener=="function"&&e.removeListener("error",r),n([].slice.call(arguments))}Ke(e,i,o,{once:!0}),i!=="error"&&An(e,r,{once:!0})})}function An(e,i,n){typeof e.on=="function"&&Ke(e,"error",i,n)}function Ke(e,i,n,t){if(typeof e.on=="function")t.once?e.once(i,n):e.on(i,n);else if(typeof e.addEventListener=="function")e.addEventListener(i,function r(o){t.once&&e.removeEventListener(i,r),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var Mn=he.exports;class kn extends Mn.EventEmitter{}var D=function(e,i){return Number(e.toFixed(i))},Ln=function(e,i){return typeof e=="number"?e:i},X=function(e,i,n){n&&typeof n=="function"&&n(e,i)},On=function(e){return-Math.cos(e*Math.PI)/2+.5},Dn=function(e){return e},Nn=function(e){return e*e},Wn=function(e){return e*(2-e)},xn=function(e){return e<.5?2*e*e:-1+(4-2*e)*e},Rn=function(e){return e*e*e},Bn=function(e){return--e*e*e+1},Zn=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},Vn=function(e){return e*e*e*e},Fn=function(e){return 1- --e*e*e*e},jn=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},qn=function(e){return e*e*e*e*e},Hn=function(e){return 1+--e*e*e*e*e},Kn=function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},Qe={easeOut:On,linear:Dn,easeInQuad:Nn,easeOutQuad:Wn,easeInOutQuad:xn,easeInCubic:Rn,easeOutCubic:Bn,easeInOutCubic:Zn,easeInQuart:Vn,easeOutQuart:Fn,easeInOutQuart:jn,easeInQuint:qn,easeOutQuint:Hn,easeInOutQuint:Kn},$e=function(e){typeof e=="number"&&cancelAnimationFrame(e)},W=function(e){e.mounted&&($e(e.animation),e.animate=!1,e.animation=null,e.velocity=null)};function Ue(e,i,n,t){if(e.mounted){var r=new Date().getTime(),o=1;W(e),e.animation=function(){if(!e.mounted)return $e(e.animation);var a=new Date().getTime()-r,s=a/n,l=Qe[i],u=l(s);a>=n?(t(o),e.animation=null):e.animation&&(t(u),requestAnimationFrame(e.animation))},requestAnimationFrame(e.animation)}}function Qn(e){var i=e.scale,n=e.positionX,t=e.positionY;return!(Number.isNaN(i)||Number.isNaN(n)||Number.isNaN(t))}function B(e,i,n,t){var r=Qn(i);if(!(!e.mounted||!r)){var o=e.setTransformState,a=e.transformState,s=a.scale,l=a.positionX,u=a.positionY,d=i.scale-s,p=i.positionX-l,f=i.positionY-u;n===0?o(i.scale,i.positionX,i.positionY):Ue(e,t,n,function(c){var v=s+d*c,y=l+p*c,w=u+f*c;o(v,y,w)})}}function $n(e,i,n){var t=e.offsetWidth,r=e.offsetHeight,o=i.offsetWidth,a=i.offsetHeight,s=o*n,l=a*n,u=t-s,d=r-l;return{wrapperWidth:t,wrapperHeight:r,newContentWidth:s,newDiffWidth:u,newContentHeight:l,newDiffHeight:d}}var Un=function(e,i,n,t,r,o,a){var s=e>i?n*(a?1:.5):0,l=t>r?o*(a?1:.5):0,u=e-i-s,d=s,p=t-r-l,f=l;return{minPositionX:u,maxPositionX:d,minPositionY:p,maxPositionY:f}},ge=function(e,i){var n=e.wrapperComponent,t=e.contentComponent,r=e.setup.centerZoomedOut;if(!n||!t)throw new Error("Components are not mounted");var o=$n(n,t,i),a=o.wrapperWidth,s=o.wrapperHeight,l=o.newContentWidth,u=o.newDiffWidth,d=o.newContentHeight,p=o.newDiffHeight,f=Un(a,l,u,s,d,p,!!r);return f},pe=function(e,i,n,t){return t?e<i?D(i,2):e>n?D(n,2):D(e,2):D(e,2)},K=function(e,i){var n=ge(e,i);return e.bounds=n,n};function re(e,i,n,t,r,o,a){var s=n.minPositionX,l=n.minPositionY,u=n.maxPositionX,d=n.maxPositionY,p=0,f=0;a&&(p=r,f=o);var c=pe(e,s-p,u+p,t),v=pe(i,l-f,d+f,t);return{x:c,y:v}}function oe(e,i,n,t,r,o){var a=e.transformState,s=a.scale,l=a.positionX,u=a.positionY,d=t-s;if(typeof i!="number"||typeof n!="number")return console.error("Mouse X and Y position were not provided!"),{x:l,y:u};var p=l-i*d,f=u-n*d,c=re(p,f,r,o,0,0,null);return c}function G(e,i,n,t,r){var o=r?t:0,a=i-o;return!Number.isNaN(n)&&e>=n?n:!Number.isNaN(i)&&e<=a?a:e}var Ee=function(e,i){var n=e.setup.panning.excluded,t=e.isInitialized,r=e.wrapperComponent,o=i.target,a="shadowRoot"in o&&"composedPath"in i,s=a?i.composedPath().some(function(d){return d instanceof Element?r==null?void 0:r.contains(d):!1}):r==null?void 0:r.contains(o),l=t&&o&&s;if(!l)return!1;var u=ae(o,n);return!u},Xe=function(e){var i=e.isInitialized,n=e.isPanning,t=e.setup,r=t.panning.disabled,o=i&&n&&!r;return!!o},Gn=function(e,i){var n=e.transformState,t=n.positionX,r=n.positionY;e.isPanning=!0;var o=i.clientX,a=i.clientY;e.startCoords={x:o-t,y:a-r}},Jn=function(e,i){var n=i.touches,t=e.transformState,r=t.positionX,o=t.positionY;e.isPanning=!0;var a=n.length===1;if(a){var s=n[0].clientX,l=n[0].clientY;e.startCoords={x:s-r,y:l-o}}};function In(e){var i=e.transformState,n=i.positionX,t=i.positionY,r=i.scale,o=e.setup,a=o.disabled,s=o.limitToBounds,l=o.centerZoomedOut,u=e.wrapperComponent;if(!(a||!u||!e.bounds)){var d=e.bounds,p=d.maxPositionX,f=d.minPositionX,c=d.maxPositionY,v=d.minPositionY,y=n>p||n<f,w=t>c||t<v,b=n>p?u.offsetWidth:e.setup.minPositionX||0,h=t>c?u.offsetHeight:e.setup.minPositionY||0,S=oe(e,b,h,r,e.bounds,s||l),k=S.x,A=S.y;return{scale:r,positionX:y?k:n,positionY:w?A:t}}}function Ge(e,i,n,t,r){var o=e.setup.limitToBounds,a=e.wrapperComponent,s=e.bounds,l=e.transformState,u=l.scale,d=l.positionX,p=l.positionY;if(!(a===null||s===null||i===d&&n===p)){var f=re(i,n,s,o,t,r,a),c=f.x,v=f.y;e.setTransformState(u,c,v)}}var ei=function(e,i,n){var t=e.startCoords,r=e.transformState,o=e.setup.panning,a=o.lockAxisX,s=o.lockAxisY,l=r.positionX,u=r.positionY;if(!t)return{x:l,y:u};var d=i-t.x,p=n-t.y,f=a?l:d,c=s?u:p;return{x:f,y:c}},Q=function(e,i){var n=e.setup,t=e.transformState,r=t.scale,o=n.minScale,a=n.disablePadding;return i>0&&r>=o&&!a?i:0},ni=function(e){var i=e.mounted,n=e.setup,t=n.disabled,r=n.velocityAnimation,o=e.transformState.scale,a=r.disabled,s=!a||o>1||!t||i;return!!s},ii=function(e){var i=e.mounted,n=e.velocity,t=e.bounds,r=e.setup,o=r.disabled,a=r.velocityAnimation,s=e.transformState.scale,l=a.disabled,u=!l||s>1||!o||i;return!(!u||!n||!t)};function ti(e,i){var n=e.setup.velocityAnimation,t=n.equalToMove,r=n.animationTime,o=n.sensitivity;return t?r*i*o:r}function _e(e,i,n,t,r,o,a,s,l,u){if(r){if(i>a&&n>a){var d=a+(e-a)*u;return d>l?l:d<a?a:d}if(i<o&&n<o){var d=o+(e-o)*u;return d<s?s:d>o?o:d}}return t?i:pe(e,o,a,r)}function ri(e,i){var n=1;return i?Math.min(n,e.offsetWidth/window.innerWidth):n}function oi(e,i){var n=ni(e);if(n){var t=e.lastMousePosition,r=e.velocityTime,o=e.setup,a=e.wrapperComponent,s=o.velocityAnimation.equalToMove,l=Date.now();if(t&&r&&a){var u=ri(a,s),d=i.x-t.x,p=i.y-t.y,f=d/u,c=p/u,v=l-r,y=d*d+p*p,w=Math.sqrt(y)/v;e.velocity={velocityX:f,velocityY:c,total:w}}e.lastMousePosition=i,e.velocityTime=l}}function ai(e){var i=e.velocity,n=e.bounds,t=e.setup,r=e.wrapperComponent,o=ii(e);if(!(!o||!i||!n||!r)){var a=i.velocityX,s=i.velocityY,l=i.total,u=n.maxPositionX,d=n.minPositionX,p=n.maxPositionY,f=n.minPositionY,c=t.limitToBounds,v=t.alignmentAnimation,y=t.zoomAnimation,w=t.panning,b=w.lockAxisY,h=w.lockAxisX,S=y.animationType,k=v.sizeX,A=v.sizeY,g=v.velocityAlignmentTime,T=g,E=ti(e,l),Y=Math.max(E,T),_=Q(e,k),M=Q(e,A),L=_*r.offsetWidth/100,x=M*r.offsetHeight/100,Z=u+L,F=d-L,J=p+x,dn=f-x,be=e.transformState,fn=new Date().getTime();Ue(e,S,Y,function(cn){var se=e.transformState,pn=se.scale,le=se.positionX,ue=se.positionY,vn=new Date().getTime()-fn,mn=vn/T,hn=Qe[v.animationType],Se=1-hn(Math.min(1,mn)),Ce=1-cn,Pe=le+a*Ce,ze=ue+s*Ce,gn=_e(Pe,be.positionX,le,h,c,d,u,F,Z,Se),yn=_e(ze,be.positionY,ue,b,c,f,p,dn,J,Se);(le!==Pe||ue!==ze)&&e.setTransformState(pn,gn,yn)})}}function Ae(e,i){var n=e.transformState.scale;W(e),K(e,n),window.TouchEvent!==void 0&&i instanceof TouchEvent?Jn(e,i):Gn(e,i)}function Je(e){var i=e.transformState.scale,n=e.setup,t=n.minScale,r=n.alignmentAnimation,o=r.disabled,a=r.sizeX,s=r.sizeY,l=r.animationTime,u=r.animationType,d=o||i<t||!a&&!s;if(!d){var p=In(e);p&&B(e,p,l,u)}}function Me(e,i,n){var t=e.startCoords,r=e.setup,o=r.alignmentAnimation,a=o.sizeX,s=o.sizeY;if(t){var l=ei(e,i,n),u=l.x,d=l.y,p=Q(e,a),f=Q(e,s);oi(e,{x:u,y:d}),Ge(e,u,d,p,f)}}function si(e){if(e.isPanning){var i=e.setup.panning.velocityDisabled,n=e.velocity,t=e.wrapperComponent,r=e.contentComponent;e.isPanning=!1,e.animate=!1,e.animation=null;var o=t==null?void 0:t.getBoundingClientRect(),a=r==null?void 0:r.getBoundingClientRect(),s=(o==null?void 0:o.width)||0,l=(o==null?void 0:o.height)||0,u=(a==null?void 0:a.width)||0,d=(a==null?void 0:a.height)||0,p=s<u||l<d,f=!i&&n&&(n==null?void 0:n.total)>.1&&p;f?ai(e):Je(e)}}function ye(e,i,n,t){var r=e.setup,o=r.minScale,a=r.maxScale,s=r.limitToBounds,l=G(D(i,2),o,a,0,!1),u=K(e,l),d=oe(e,n,t,l,u,s),p=d.x,f=d.y;return{scale:l,positionX:p,positionY:f}}function Ie(e,i,n){var t=e.transformState.scale,r=e.wrapperComponent,o=e.setup,a=o.minScale,s=o.limitToBounds,l=o.zoomAnimation,u=l.disabled,d=l.animationTime,p=l.animationType,f=u||t>=a;if((t>=1||s)&&Je(e),!(f||!r||!e.mounted)){var c=i||r.offsetWidth/2,v=n||r.offsetHeight/2,y=ye(e,a,c,v);y&&B(e,y,d,p)}}var R=function(){return R=Object.assign||function(i){for(var n,t=1,r=arguments.length;t<r;t++){n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},R.apply(this,arguments)};function ke(e,i,n){if(n||arguments.length===2)for(var t=0,r=i.length,o;t<r;t++)(o||!(t in i))&&(o||(o=Array.prototype.slice.call(i,0,t)),o[t]=i[t]);return e.concat(o||Array.prototype.slice.call(i))}var ee={previousScale:1,scale:1,positionX:0,positionY:0},$={disabled:!1,minPositionX:null,maxPositionX:null,minPositionY:null,maxPositionY:null,minScale:1,maxScale:8,limitToBounds:!0,centerZoomedOut:!1,centerOnInit:!1,disablePadding:!1,smooth:!0,wheel:{step:.2,disabled:!1,smoothStep:.001,wheelDisabled:!1,touchPadDisabled:!1,activationKeys:[],excluded:[]},panning:{disabled:!1,velocityDisabled:!1,lockAxisX:!1,lockAxisY:!1,allowLeftClickPan:!0,allowMiddleClickPan:!0,allowRightClickPan:!0,wheelPanning:!1,activationKeys:[],excluded:[]},pinch:{step:5,disabled:!1,excluded:[]},doubleClick:{disabled:!1,step:.7,mode:"zoomIn",animationType:"easeOut",animationTime:200,excluded:[]},zoomAnimation:{disabled:!1,size:.4,animationTime:200,animationType:"easeOut"},alignmentAnimation:{disabled:!1,sizeX:100,sizeY:100,animationTime:200,velocityAlignmentTime:400,animationType:"easeOut"},velocityAnimation:{disabled:!1,sensitivity:1,animationTime:400,animationType:"easeOut",equalToMove:!0}},en=function(e){var i,n,t,r;return{previousScale:(i=e.initialScale)!==null&&i!==void 0?i:ee.scale,scale:(n=e.initialScale)!==null&&n!==void 0?n:ee.scale,positionX:(t=e.initialPositionX)!==null&&t!==void 0?t:ee.positionX,positionY:(r=e.initialPositionY)!==null&&r!==void 0?r:ee.positionY}},Le=function(e){var i=R({},$);return Object.keys(e).forEach(function(n){var t=typeof e[n]<"u",r=typeof $[n]<"u";if(r&&t){var o=Object.prototype.toString.call($[n]),a=o==="[object Object]",s=o==="[object Array]";a?i[n]=R(R({},$[n]),e[n]):s?i[n]=ke(ke([],$[n],!0),e[n],!0):i[n]=e[n]}}),i},nn=function(e,i,n){var t=e.transformState.scale,r=e.wrapperComponent,o=e.setup,a=o.maxScale,s=o.minScale,l=o.zoomAnimation,u=o.smooth,d=l.size;if(!r)throw new Error("Wrapper is not mounted");var p=u?t*Math.exp(i*n):t+i*n,f=G(D(p,3),s,a,d,!1);return f};function tn(e,i,n,t,r){var o=e.wrapperComponent,a=e.transformState,s=a.scale,l=a.positionX,u=a.positionY;if(!o)return console.error("No WrapperComponent found");var d=o.offsetWidth,p=o.offsetHeight,f=(d/2-l)/s,c=(p/2-u)/s,v=nn(e,i,n),y=ye(e,v,f,c);if(!y)return console.error("Error during zoom event. New transformation state was not calculated.");B(e,y,t,r)}function rn(e,i,n,t){var r=e.setup,o=e.wrapperComponent,a=r.limitToBounds,s=en(e.props),l=e.transformState,u=l.scale,d=l.positionX,p=l.positionY;if(o){var f=ge(e,s.scale),c=re(s.positionX,s.positionY,f,a,0,0,o),v={scale:s.scale,positionX:c.x,positionY:c.y};u===s.scale&&d===s.positionX&&p===s.positionY||(t==null||t(),B(e,v,i,n))}}function li(e,i,n,t){var r=e.getBoundingClientRect(),o=i.getBoundingClientRect(),a=n.getBoundingClientRect(),s=o.x*t.scale,l=o.y*t.scale;return{x:(r.x-a.x+s)/t.scale,y:(r.y-a.y+l)/t.scale}}function ui(e,i,n){var t=e.wrapperComponent,r=e.contentComponent,o=e.transformState,a=e.setup,s=a.limitToBounds,l=a.minScale,u=a.maxScale;if(!t||!r)return o;var d=t.getBoundingClientRect(),p=i.getBoundingClientRect(),f=li(i,t,r,o),c=f.x,v=f.y,y=p.width/o.scale,w=p.height/o.scale,b=t.offsetWidth/y,h=t.offsetHeight/w,S=G(n||Math.min(b,h),l,u,0,!1),k=(d.width-y*S)/2,A=(d.height-w*S)/2,g=(d.left-c)*S+k,T=(d.top-v)*S+A,E=ge(e,S),Y=re(g,T,E,s,0,0,t),_=Y.x,M=Y.y;return{positionX:_,positionY:M,scale:S}}var di=function(e){return function(i,n,t){i===void 0&&(i=.5),n===void 0&&(n=300),t===void 0&&(t="easeOut"),tn(e,1,i,n,t)}},fi=function(e){return function(i,n,t){i===void 0&&(i=.5),n===void 0&&(n=300),t===void 0&&(t="easeOut"),tn(e,-1,i,n,t)}},ci=function(e){return function(i,n,t,r,o){r===void 0&&(r=300),o===void 0&&(o="easeOut");var a=e.transformState,s=a.positionX,l=a.positionY,u=a.scale,d=e.wrapperComponent,p=e.contentComponent,f=e.setup.disabled;if(!(f||!d||!p)){var c={positionX:Number.isNaN(i)?s:i,positionY:Number.isNaN(n)?l:n,scale:Number.isNaN(t)?u:t};B(e,c,r,o)}}},pi=function(e){return function(i,n){i===void 0&&(i=200),n===void 0&&(n="easeOut"),rn(e,i,n)}},vi=function(e){return function(i,n,t){n===void 0&&(n=200),t===void 0&&(t="easeOut");var r=e.transformState,o=e.wrapperComponent,a=e.contentComponent;if(o&&a){var s=on(i||r.scale,o,a);B(e,s,n,t)}}},mi=function(e){return function(i,n,t,r){t===void 0&&(t=600),r===void 0&&(r="easeOut"),W(e);var o=e.wrapperComponent,a=typeof i=="string"?document.getElementById(i):i;if(o&&a&&o.contains(a)){var s=ui(e,a,n);B(e,s,t,r)}}},ve=function(e){return{instance:e,zoomIn:di(e),zoomOut:fi(e),setTransform:ci(e),resetTransform:pi(e),centerView:vi(e),zoomToElement:mi(e)}},hi=function(e){return{instance:e,state:e.transformState}},z=function(e){var i={};return Object.assign(i,hi(e)),Object.assign(i,ve(e)),i},fe=!1;function ce(){try{var e={get passive(){return fe=!0,!1}};return e}catch{return fe=!1,fe}}var ae=function(e,i){return i.some(function(n){return e.matches("".concat(n,", .").concat(n,", ").concat(n," *, .").concat(n," *"))})},me=function(e){e&&clearTimeout(e)},gi=function(e,i,n){return"translate(".concat(e,"px, ").concat(i,"px) scale(").concat(n,")")},on=function(e,i,n){var t=n.offsetWidth*e,r=n.offsetHeight*e,o=(i.offsetWidth-t)/2,a=(i.offsetHeight-r)/2;return{scale:e,positionX:o,positionY:a}};function yi(e){return function(i){e.forEach(function(n){typeof n=="function"?n(i):n!=null&&(n.current=i)})}}var wi=function(e,i){var n=e.setup.wheel,t=n.disabled,r=n.wheelDisabled,o=n.touchPadDisabled,a=n.excluded,s=e.isInitialized,l=e.isPanning,u=i.target,d=s&&!l&&!t&&u;if(!d||r&&!i.ctrlKey||o&&i.ctrlKey)return!1;var p=ae(u,a);return!p},bi=function(e){return e?e.deltaY<0?1:-1:0};function Si(e,i){var n=bi(e),t=Ln(i,n);return t}function an(e,i,n){var t=i.getBoundingClientRect(),r=0,o=0;if("clientX"in e)r=(e.clientX-t.left)/n,o=(e.clientY-t.top)/n;else{var a=e.touches[0];r=(a.clientX-t.left)/n,o=(a.clientY-t.top)/n}return(Number.isNaN(r)||Number.isNaN(o))&&console.error("No mouse or touch offset found"),{x:r,y:o}}var Ci=function(e,i,n,t,r){var o=e.transformState.scale,a=e.wrapperComponent,s=e.setup,l=s.maxScale,u=s.minScale,d=s.zoomAnimation,p=s.disablePadding,f=d.size,c=d.disabled;if(!a)throw new Error("Wrapper is not mounted");var v=o+i*n;if(r)return v;var y=t?!1:!c,w=G(D(v,3),u,l,f,y&&!p);return w},Pi=function(e,i){var n=e.previousWheelEvent,t=e.transformState.scale,r=e.setup,o=r.maxScale,a=r.minScale;return n?t<o||t>a||Math.sign(n.deltaY)!==Math.sign(i.deltaY)||n.deltaY>0&&n.deltaY<i.deltaY||n.deltaY<0&&n.deltaY>i.deltaY||Math.sign(n.deltaY)!==Math.sign(i.deltaY):!1},zi=function(e,i){var n=e.setup.pinch,t=n.disabled,r=n.excluded,o=e.isInitialized,a=i.target,s=o&&!t&&a;if(!s)return!1;var l=ae(a,r);return!l},Ti=function(e){var i=e.setup.pinch.disabled,n=e.isInitialized,t=e.pinchStartDistance,r=n&&!i&&t;return!!r},Yi=function(e,i,n){var t=n.getBoundingClientRect(),r=e.touches,o=D(r[0].clientX-t.left,5),a=D(r[0].clientY-t.top,5),s=D(r[1].clientX-t.left,5),l=D(r[1].clientY-t.top,5);return{x:(o+s)/2/i,y:(a+l)/2/i}},sn=function(e){return Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2))},Ei=function(e,i){var n=e.pinchStartScale,t=e.pinchStartDistance,r=e.setup,o=r.maxScale,a=r.minScale,s=r.zoomAnimation,l=r.disablePadding,u=s.size,d=s.disabled;if(!n||t===null||!i)throw new Error("Pinch touches distance was not provided");if(i<0)return e.transformState.scale;var p=i/t,f=p*n;return G(D(f,2),a,o,u,!d&&!l)},Xi=160,_i=100,Ai=function(e,i){var n=e.props,t=n.onWheelStart,r=n.onZoomStart;e.wheelStopEventTimer||(W(e),X(z(e),i,t),X(z(e),i,r))},Mi=function(e,i){var n=e.props,t=n.onWheel,r=n.onZoom,o=e.contentComponent,a=e.setup,s=e.transformState,l=s.scale,u=a.limitToBounds,d=a.centerZoomedOut,p=a.zoomAnimation,f=a.wheel,c=a.disablePadding,v=a.smooth,y=p.size,w=p.disabled,b=f.step,h=f.smoothStep;if(!o)throw new Error("Component not mounted");i.preventDefault(),i.stopPropagation();var S=Si(i,null),k=v?h*Math.abs(i.deltaY):b,A=Ci(e,S,k,!i.ctrlKey);if(l!==A){var g=K(e,A),T=an(i,o,l),E=w||y===0||d||c,Y=u&&E,_=oe(e,T.x,T.y,A,g,Y),M=_.x,L=_.y;e.previousWheelEvent=i,e.setTransformState(A,M,L),X(z(e),i,t),X(z(e),i,r)}},ki=function(e,i){var n=e.props,t=n.onWheelStop,r=n.onZoomStop;me(e.wheelAnimationTimer),e.wheelAnimationTimer=setTimeout(function(){e.mounted&&(Ie(e,i.x,i.y),e.wheelAnimationTimer=null)},_i);var o=Pi(e,i);o&&(me(e.wheelStopEventTimer),e.wheelStopEventTimer=setTimeout(function(){e.mounted&&(e.wheelStopEventTimer=null,X(z(e),i,t),X(z(e),i,r))},Xi))},Li=function(e,i){var n=sn(i);e.pinchStartDistance=n,e.lastDistance=n,e.pinchStartScale=e.transformState.scale,e.isPanning=!1,W(e)},Oi=function(e,i){var n=e.contentComponent,t=e.pinchStartDistance,r=e.transformState.scale,o=e.setup,a=o.limitToBounds,s=o.centerZoomedOut,l=o.zoomAnimation,u=l.disabled,d=l.size;if(!(t===null||!n)){var p=Yi(i,r,n);if(!(!Number.isFinite(p.x)||!Number.isFinite(p.y))){var f=sn(i),c=Ei(e,f);if(c!==r){var v=K(e,c),y=u||d===0||s,w=a&&y,b=oe(e,p.x,p.y,c,v,w),h=b.x,S=b.y;e.pinchMidpoint=p,e.lastDistance=f,e.setTransformState(c,h,S)}}}},Di=function(e){var i=e.pinchMidpoint;e.velocity=null,e.lastDistance=null,e.pinchMidpoint=null,e.pinchStartScale=null,e.pinchStartDistance=null,Ie(e,i==null?void 0:i.x,i==null?void 0:i.y)},ln=function(e,i){var n=e.props.onZoomStop,t=e.setup.doubleClick.animationTime;me(e.doubleClickStopEventTimer),e.doubleClickStopEventTimer=setTimeout(function(){e.doubleClickStopEventTimer=null,X(z(e),i,n)},t)},Ni=function(e,i){var n=e.props,t=n.onZoomStart,r=n.onZoom,o=e.setup.doubleClick,a=o.animationTime,s=o.animationType;X(z(e),i,t),rn(e,a,s,function(){return X(z(e),i,r)}),ln(e,i)};function Wi(e,i){return e==="toggle"?i===1?1:-1:e==="zoomOut"?-1:1}function xi(e,i){var n=e.setup,t=e.doubleClickStopEventTimer,r=e.transformState,o=e.contentComponent,a=r.scale,s=e.props,l=s.onZoomStart,u=s.onZoom,d=n.doubleClick,p=d.disabled,f=d.mode,c=d.step,v=d.animationTime,y=d.animationType;if(!p&&!t){if(f==="reset")return Ni(e,i);if(!o)return console.error("No ContentComponent found");var w=Wi(f,e.transformState.scale),b=nn(e,w,c);if(a!==b){X(z(e),i,l);var h=an(i,o,a),S=ye(e,b,h.x,h.y);if(!S)return console.error("Error during zoom event. New transformation state was not calculated.");X(z(e),i,u),B(e,S,v,y),ln(e,i)}}}var Ri=function(e,i){var n=e.isInitialized,t=e.setup,r=e.wrapperComponent,o=t.doubleClick,a=o.disabled,s=o.excluded,l=i.target,u=r==null?void 0:r.contains(l),d=n&&l&&u&&!a;if(!d)return!1;var p=ae(l,s);return!p},Bi=function(){function e(i){var n=this;this.mounted=!0,this.onChangeCallbacks=new Set,this.onInitCallbacks=new Set,this.wrapperComponent=null,this.contentComponent=null,this.isInitialized=!1,this.bounds=null,this.previousWheelEvent=null,this.wheelStopEventTimer=null,this.wheelAnimationTimer=null,this.isPanning=!1,this.isWheelPanning=!1,this.startCoords=null,this.lastTouch=null,this.distance=null,this.lastDistance=null,this.pinchStartDistance=null,this.pinchStartScale=null,this.pinchMidpoint=null,this.doubleClickStopEventTimer=null,this.velocity=null,this.velocityTime=null,this.lastMousePosition=null,this.animate=!1,this.animation=null,this.maxBounds=null,this.pressedKeys={},this.mount=function(){n.initializeWindowEvents()},this.unmount=function(){n.cleanupWindowEvents()},this.update=function(t){n.props=t,K(n,n.transformState.scale),n.setup=Le(t)},this.initializeWindowEvents=function(){var t,r,o=ce(),a=(t=n.wrapperComponent)===null||t===void 0?void 0:t.ownerDocument,s=a==null?void 0:a.defaultView;(r=n.wrapperComponent)===null||r===void 0||r.addEventListener("wheel",n.onWheelPanning,o),s==null||s.addEventListener("mousedown",n.onPanningStart,o),s==null||s.addEventListener("mousemove",n.onPanning,o),s==null||s.addEventListener("mouseup",n.onPanningStop,o),a==null||a.addEventListener("mouseleave",n.clearPanning,o),s==null||s.addEventListener("keyup",n.setKeyUnPressed,o),s==null||s.addEventListener("keydown",n.setKeyPressed,o)},this.cleanupWindowEvents=function(){var t,r,o=ce(),a=(t=n.wrapperComponent)===null||t===void 0?void 0:t.ownerDocument,s=a==null?void 0:a.defaultView;s==null||s.removeEventListener("mousedown",n.onPanningStart,o),s==null||s.removeEventListener("mousemove",n.onPanning,o),s==null||s.removeEventListener("mouseup",n.onPanningStop,o),a==null||a.removeEventListener("mouseleave",n.clearPanning,o),s==null||s.removeEventListener("keyup",n.setKeyUnPressed,o),s==null||s.removeEventListener("keydown",n.setKeyPressed,o),document.removeEventListener("mouseleave",n.clearPanning,o),W(n),(r=n.observer)===null||r===void 0||r.disconnect()},this.handleInitializeWrapperEvents=function(t){var r=ce();t.addEventListener("wheel",n.onWheelZoom,r),t.addEventListener("dblclick",n.onDoubleClick,r),t.addEventListener("touchstart",n.onTouchPanningStart,r),t.addEventListener("touchmove",n.onTouchPanning,r),t.addEventListener("touchend",n.onTouchPanningStop,r)},this.handleInitialize=function(t){var r=n.setup.centerOnInit;n.applyTransformation(),n.onInitCallbacks.forEach(function(o){return o(z(n))}),r&&(n.setCenter(),n.observer=new ResizeObserver(function(){var o,a=t.offsetWidth,s=t.offsetHeight;(a>0||s>0)&&(n.onInitCallbacks.forEach(function(l){return l(z(n))}),n.setCenter(),(o=n.observer)===null||o===void 0||o.disconnect())}),setTimeout(function(){var o;(o=n.observer)===null||o===void 0||o.disconnect()},5e3),n.observer.observe(t))},this.onWheelZoom=function(t){var r=n.setup.disabled;if(!r){var o=wi(n,t);if(o){var a=n.isPressingKeys(n.setup.wheel.activationKeys);a&&(Ai(n,t),Mi(n,t),ki(n,t))}}},this.onWheelPanning=function(t){var r=n.setup,o=r.disabled,a=r.wheel,s=r.panning;if(!(!n.wrapperComponent||!n.contentComponent||o||!a.wheelDisabled||s.disabled||!s.wheelPanning||t.ctrlKey)){t.preventDefault(),t.stopPropagation();var l=n.transformState,u=l.positionX,d=l.positionY,p=u-t.deltaX,f=d-t.deltaY,c=s.lockAxisX?u:p,v=s.lockAxisY?d:f,y=n.setup.alignmentAnimation,w=y.sizeX,b=y.sizeY,h=Q(n,w),S=Q(n,b);c===u&&v===d||Ge(n,c,v,h,S)}},this.onPanningStart=function(t){var r=n.setup.disabled,o=n.props.onPanningStart;if(!r){var a=Ee(n,t);if(a){var s=n.isPressingKeys(n.setup.panning.activationKeys);s&&(t.button===0&&!n.setup.panning.allowLeftClickPan||t.button===1&&!n.setup.panning.allowMiddleClickPan||t.button===2&&!n.setup.panning.allowRightClickPan||(t.preventDefault(),t.stopPropagation(),W(n),Ae(n,t),X(z(n),t,o)))}}},this.onPanning=function(t){var r=n.setup.disabled,o=n.props.onPanning;if(!r){var a=Xe(n);if(a){var s=n.isPressingKeys(n.setup.panning.activationKeys);s&&(t.preventDefault(),t.stopPropagation(),Me(n,t.clientX,t.clientY),X(z(n),t,o))}}},this.onPanningStop=function(t){var r=n.props.onPanningStop;n.isPanning&&(si(n),X(z(n),t,r))},this.onPinchStart=function(t){var r=n.setup.disabled,o=n.props,a=o.onPinchingStart,s=o.onZoomStart;if(!r){var l=zi(n,t);l&&(Li(n,t),W(n),X(z(n),t,a),X(z(n),t,s))}},this.onPinch=function(t){var r=n.setup.disabled,o=n.props,a=o.onPinching,s=o.onZoom;if(!r){var l=Ti(n);l&&(t.preventDefault(),t.stopPropagation(),Oi(n,t),X(z(n),t,a),X(z(n),t,s))}},this.onPinchStop=function(t){var r=n.props,o=r.onPinchingStop,a=r.onZoomStop;n.pinchStartScale&&(Di(n),X(z(n),t,o),X(z(n),t,a))},this.onTouchPanningStart=function(t){var r=n.setup.disabled,o=n.props.onPanningStart;if(!r){var a=Ee(n,t);if(a){var s=n.lastTouch&&+new Date-n.lastTouch<200;if(s&&t.touches.length===1)n.onDoubleClick(t);else{n.lastTouch=+new Date,W(n);var l=t.touches,u=l.length===1,d=l.length===2;u&&(W(n),Ae(n,t),X(z(n),t,o)),d&&n.onPinchStart(t)}}}},this.onTouchPanning=function(t){var r=n.setup.disabled,o=n.props.onPanning;if(n.isPanning&&t.touches.length===1){if(r)return;var a=Xe(n);if(!a)return;t.preventDefault(),t.stopPropagation();var s=t.touches[0];Me(n,s.clientX,s.clientY),X(z(n),t,o)}else t.touches.length>1&&n.onPinch(t)},this.onTouchPanningStop=function(t){n.onPanningStop(t),n.onPinchStop(t)},this.onDoubleClick=function(t){var r=n.setup.disabled;if(!r){var o=Ri(n,t);o&&xi(n,t)}},this.clearPanning=function(t){n.isPanning&&n.onPanningStop(t)},this.setKeyPressed=function(t){n.pressedKeys[t.key]=!0},this.setKeyUnPressed=function(t){n.pressedKeys[t.key]=!1},this.isPressingKeys=function(t){return t.length?!!t.find(function(r){return n.pressedKeys[r]}):!0},this.setTransformState=function(t,r,o){var a=n.props.onTransformed;if(!Number.isNaN(t)&&!Number.isNaN(r)&&!Number.isNaN(o)){t!==n.transformState.scale&&(n.transformState.previousScale=n.transformState.scale,n.transformState.scale=t),n.transformState.positionX=r,n.transformState.positionY=o,n.applyTransformation();var s=z(n);n.onChangeCallbacks.forEach(function(l){return l(s)}),X(s,{scale:t,positionX:r,positionY:o},a)}else console.error("Detected NaN set state values")},this.setCenter=function(){if(n.wrapperComponent&&n.contentComponent){var t=on(n.transformState.scale,n.wrapperComponent,n.contentComponent);n.setTransformState(t.scale,t.positionX,t.positionY)}},this.handleTransformStyles=function(t,r,o){return n.props.customTransform?n.props.customTransform(t,r,o):gi(t,r,o)},this.applyTransformation=function(){if(!(!n.mounted||!n.contentComponent)){var t=n.transformState,r=t.scale,o=t.positionX,a=t.positionY,s=n.handleTransformStyles(o,a,r);n.contentComponent.style.transform=s}},this.getContext=function(){return z(n)},this.onChange=function(t){return n.onChangeCallbacks.has(t)||n.onChangeCallbacks.add(t),function(){n.onChangeCallbacks.delete(t)}},this.onInit=function(t){return n.onInitCallbacks.has(t)||n.onInitCallbacks.add(t),function(){n.onInitCallbacks.delete(t)}},this.init=function(t,r){n.cleanupWindowEvents(),n.wrapperComponent=t,n.contentComponent=r,K(n,n.transformState.scale),n.handleInitializeWrapperEvents(t),n.handleInitialize(r),n.initializeWindowEvents(),n.isInitialized=!0;var o=z(n);X(o,void 0,n.props.onInit)},this.props=i,this.setup=Le(this.props),this.transformState=en(this.props)}return e}(),we=V.createContext(null),Zi=function(e,i){return typeof e=="function"?e(i):e},Vi=V.forwardRef(function(e,i){var n=m.useRef(new Bi(e)).current,t=Zi(e.children,ve(n));return m.useImperativeHandle(i,function(){return ve(n)},[n]),m.useEffect(function(){n.update(e)},[n,e]),V.createElement(we.Provider,{value:n},t)});V.forwardRef(function(e,i){var n=m.useRef(null),t=m.useContext(we);return m.useEffect(function(){return t.onChange(function(r){if(n.current){var o=0,a=0;n.current.style.transform=t.handleTransformStyles(o,a,1/r.instance.transformState.scale)}})},[t]),V.createElement("div",R({},e,{ref:yi([n,i])}))});function Fi(e,i){i===void 0&&(i={});var n=i.insertAt;if(!(!e||typeof document>"u")){var t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",n==="top"&&t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}var ji=`.transform-component-module_wrapper__SPB86 {
  position: relative;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  overflow: hidden;
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none;
  margin: 0;
  padding: 0;
}
.transform-component-module_content__FBWxo {
  display: flex;
  flex-wrap: wrap;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  margin: 0;
  padding: 0;
  transform-origin: 0% 0%;
}
.transform-component-module_content__FBWxo img {
  pointer-events: none;
}
`,Oe={wrapper:"transform-component-module_wrapper__SPB86",content:"transform-component-module_content__FBWxo"};Fi(ji);var qi=function(e){var i=e.children,n=e.wrapperClass,t=n===void 0?"":n,r=e.contentClass,o=r===void 0?"":r,a=e.wrapperStyle,s=e.contentStyle,l=e.wrapperProps,u=l===void 0?{}:l,d=e.contentProps,p=d===void 0?{}:d,f=m.useContext(we),c=f.init,v=f.cleanupWindowEvents,y=m.useRef(null),w=m.useRef(null);return m.useEffect(function(){var b=y.current,h=w.current;return b!==null&&h!==null&&c&&(c==null||c(b,h)),function(){v==null||v()}},[]),V.createElement("div",R({},u,{ref:y,className:"react-transform-wrapper ".concat(Oe.wrapper," ").concat(t),style:a}),V.createElement("div",R({},p,{ref:w,className:"react-transform-component ".concat(Oe.content," ").concat(o),style:s}),i))};const Hi=({toggleFullMap:e,adapter:i})=>{const[n,t]=m.useState(()=>new Set),r=m.useRef(null),o=m.useRef(!1),[a,s]=m.useState({x:0,y:0,z:0}),l=m.useRef({scale:1,positionX:0,positionY:0}),u=m.useRef({columns:0,rows:0}),[d,p]=m.useState(!1),[f,c]=m.useState(void 0),[v,y]=m.useState(void 0),w=()=>{var E,Y;const b=(Y=(E=r.current)==null?void 0:E.instance.wrapperComponent)==null?void 0:Y.getBoundingClientRect();if(!b)return;const h=64,S=Math.ceil(b.width/(h*l.current.scale)),k=Math.ceil(b.height/(h*l.current.scale));u.current.rows=k,u.current.columns=S;const A=-Math.floor(l.current.positionX/(l.current.scale*h))*h,g=-Math.floor(l.current.positionY/(l.current.scale*h))*h,T=new Set;for(let _=-1;_<k;_+=1)for(let M=-1;M<S;M+=1){const L=A+M*h,x=g+_*h;T.add(`${L},${x}`)}t(T)};return m.useEffect(()=>{i.full=!0,console.log("[fullmap] set full property to true"),w()},[]),O("div",{style:{position:"fixed",isolation:"isolate",inset:"0px",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:100},children:[window.screen.width>500?C("div",{style:{position:"absolute",width:"100%",height:"100%",zIndex:"-1"},onClick:e}):C(U,{icon:"close-box",onClick:e,style:{position:"absolute",top:"20px",right:"20px",zIndex:1}}),C(Vi,{limitToBounds:!1,ref:r,minScale:.1,doubleClick:{disabled:!1},panning:{allowLeftClickPan:!0,allowRightClickPan:!1},onTransformed:(b,h)=>{l.current={...h}},onPanningStop:()=>{w()},onZoomStop:()=>{w()},children:C(qi,{wrapperClass:"map",wrapperStyle:{willChange:"transform"},children:[...n].map(b=>{var Y,_;const[h,S]=b.split(",").map(Number),k=Math.floor(i.playerPosition.x/16)*16,A=Math.floor(i.playerPosition.z/16)*16,g=(_=(Y=r.current)==null?void 0:Y.instance.wrapperComponent)==null?void 0:_.getBoundingClientRect(),T=Math.floor(((g==null?void 0:g.width)??0)/(8*16))*16,E=Math.floor(((g==null?void 0:g.height)??0)/(8*16))*16;return C(Ki,{x:h,y:S,scale:l.current.scale,adapter:i,worldX:k+h/4-T,worldZ:A+S/4-E,setIsWarpInfoOpened:p,setLastWarpPos:s,redraw:o.current,setInitWarp:c,setWarpPreview:y},"mapcell:"+b)})})}),v&&O("div",{style:{position:"absolute",top:v.clientY-70,left:v.clientX-70,textAlign:"center",fontSize:"1.5em",textShadow:"0.1em 0 black, 0 0.1em black, -0.1em 0 black, 0 -0.1em black, -0.1em -0.1em black, -0.1em 0.1em black, 0.1em -0.1em black, 0.1em 0.1em black"},children:[v.name,O("div",{children:[v.x," ",v.z]})]}),d&&C(Qi,{adapter:i,warpPos:a,setIsWarpInfoOpened:p,afterWarpIsSet:()=>{o.current=!o.current},initWarp:f,setInitWarp:c,toggleFullMap:e})]})},Ki=({x:e,y:i,scale:n,adapter:t,worldX:r,worldZ:o,setIsWarpInfoOpened:a,setLastWarpPos:s,redraw:l,setInitWarp:u,setWarpPreview:d})=>{const p=m.useRef(null),f=m.useRef(null),c=m.useRef(null),v=m.useRef(null),[y,w]=m.useState(!1),b=g=>{c.current=setTimeout(()=>{c.current=null,S(g)},500)},h=()=>{c.current&&clearTimeout(c.current)},S=g=>{if(!f.current)return;let T,E;if("buttons"in g&&g.button===2)T=g.clientX,E=g.clientY;else if("changedTouches"in g)T=g.changedTouches[0].clientX,E=g.changedTouches[0].clientY;else return;const[Y,_]=k(T,E),M=Math.floor(Y+r),L=Math.floor(_+o),x=t.getHighestBlockY(M,L);f.current.setWarpPosOnClick(new Re(M,x,L)),s(f.current.lastWarpPos);const{lastWarpPos:Z}=f.current,F=t.warps.find(J=>Math.hypot(Z.x-J.x,Z.z-J.z)<2);u==null||u(F),a(!0)},k=(g,T)=>{var L;const E=v.current.getBoundingClientRect(),Y=n*(((L=f.current)==null?void 0:L.mapPixel)??1),_=(g-E.left)/Y,M=(T-E.top)/Y;return[_,M]},A=g=>{const[T,E]=k(g.clientX,g.clientY),Y=t.warps.find(_=>Math.hypot(_.x-T-r,_.z-E-o)<2);d==null||d(Y?{name:Y.name,x:Y.x,z:Y.z,clientX:g.clientX,clientY:g.clientY}:void 0)};return m.useEffect(()=>{v.current&&t.drawChunkOnCanvas(`${r/16},${o/16}`,v.current)},[v.current]),m.useEffect(()=>{var g,T,E,Y,_;return(g=v.current)==null||g.addEventListener("contextmenu",S),(T=v.current)==null||T.addEventListener("touchstart",b),(E=v.current)==null||E.addEventListener("touchend",h),(Y=v.current)==null||Y.addEventListener("touchmove",h),(_=v.current)==null||_.addEventListener("mousemove",A),()=>{var M,L,x,Z,F;(M=v.current)==null||M.removeEventListener("contextmenu",S),(L=v.current)==null||L.removeEventListener("touchstart",b),(x=v.current)==null||x.removeEventListener("touchend",h),(Z=v.current)==null||Z.removeEventListener("touchmove",h),(F=v.current)==null||F.removeEventListener("mousemove",A)}},[v.current,n]),m.useEffect(()=>{},[f.current,l]),m.useEffect(()=>{const g=new IntersectionObserver(T=>{for(const E of T)E.isIntersecting&&w(!0)});return g.observe(p.current),()=>{g.disconnect()}},[]),C("div",{ref:p,style:{position:"absolute",width:"64px",height:"64px",top:`${i}px`,left:`${e}px`},children:C("canvas",{ref:v,style:{width:"100%",height:"100%",imageRendering:"pixelated"},width:64,height:64})})},Qi=({adapter:e,warpPos:i,setIsWarpInfoOpened:n,afterWarpIsSet:t,initWarp:r,toggleFullMap:o})=>{const[a,s]=m.useState(r??{name:"",x:(i==null?void 0:i.x)??100,y:(i==null?void 0:i.y)??100,z:(i==null?void 0:i.z)??100,color:"",disabled:!1,world:e.world}),l={flexGrow:"1"},u={display:"flex",alignItems:"center",gap:"5px"},d=()=>{for(let f=-1;f<2;f+=1)for(let c=-1;c<2;c+=1)e.emit("chunkReady",`${Math.floor(a.x/16)+c},${Math.floor(a.z/16)+f}`)},p=()=>{var f;o==null||o({command:"ui.toggleMap"}),(f=e.quickTp)==null||f.call(e,a.x,a.z)};return C("div",{style:{position:"absolute",inset:"0px",display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",backgroundColor:"rgba(0, 0, 0, 0.5)",fontSize:"0.8em",transform:"scale(2)"},children:O("form",{style:{display:"flex",flexDirection:"column",gap:"10px",width:window.screen.width>500?"100%":"50%",minWidth:"100px",maxWidth:"300px",padding:"20px",backgroundColor:"rgba(0, 0, 0, 0.5)",border:"2px solid black"},children:[C("h2",{style:{alignSelf:"center"},children:"Point on the map"}),O("div",{style:u,children:[C("div",{children:"Name:"}),C(I,{defaultValue:a.name,onChange:f=>{f.target&&s(c=>({...c,name:f.target.value}))},autoFocus:!0})]}),O("div",{style:u,children:[C("div",{children:"X:"}),C(I,{rootStyles:l,defaultValue:a.x??100,onChange:f=>{f.target&&s(c=>({...c,x:Number(f.target.value)}))}}),C("div",{children:"Z:"}),C(I,{rootStyles:l,defaultValue:a.z??100,onChange:f=>{f.target&&s(c=>({...c,z:Number(f.target.value)}))}})]}),O("div",{style:u,children:[C("div",{children:"Color:"}),C(I,{type:"color",defaultValue:a.color===""?"#232323":a.color,onChange:f=>{f.target&&s(c=>({...c,color:f.target.value}))},rootStyles:{width:"30px"},style:{left:"0px"}})]}),O("div",{style:u,children:[C("label",{htmlFor:"warp-disabled",children:"Disabled:"}),C("input",{id:"warp-disabled",type:"checkbox",checked:a.disabled??!1,onChange:f=>{f.target&&s(c=>({...c,disabled:f.target.checked}))}})]}),C(U,{style:{alignSelf:"center"},onClick:()=>{p()},children:"Quick TP"}),O("div",{style:u,children:[C(U,{onClick:()=>{n(!1)},children:"Cancel"}),C(U,{onClick:()=>{e.setWarp({...a}),console.log(e.warps),n(!1),d(),t==null||t()},type:"submit",children:"Add Warp"}),r&&C(U,{onClick:()=>{e.warps.findIndex(c=>c.name===a.name)!==-1&&(e.setWarp({name:a.name,x:0,y:0,z:0,color:"",disabled:!1,world:""},!0),n(!1),d(),t==null||t())},children:"Delete"})]})]})})};try{Fullmap.displayName="Fullmap",Fullmap.__docgenInfo={description:"",displayName:"Fullmap",props:{toggleFullMap:{defaultValue:null,description:"",name:"toggleFullMap",required:!0,type:{name:"() => void"}},adapter:{defaultValue:null,description:"",name:"adapter",required:!0,type:{name:"DrawerAdapter"}},drawer:{defaultValue:null,description:"",name:"drawer",required:!0,type:{name:"MinimapDrawer | null"}},canvasRef:{defaultValue:null,description:"",name:"canvasRef",required:!0,type:{name:"any"}}}}}catch{}const $i=({adapter:e,showMinimap:i,showFullmap:n,singleplayer:t,fullMap:r,toggleFullMap:o,displayMode:a})=>{const s=m.useRef(!1),l=m.useRef(0),u=m.useRef(null),d=m.useRef(null),p=m.useRef(null),f=m.useRef(null),c=m.useRef(null);m.useRef(null);const[v,y]=m.useState({x:0,y:0,z:0}),w=()=>{y({x:e.playerPosition.x,y:e.playerPosition.y,z:e.playerPosition.z}),c.current&&(s.current||(h(),c.current.draw(e.playerPosition),c.current.drawPlayerPos(),c.current.drawWarps()),l.current%300===0&&!r&&("requestIdleCallback"in window?requestIdleCallback(()=>{var A;(A=c.current)==null||A.clearChunksStore()}):c.current.clearChunksStore(),l.current=0)),l.current+=1},b=()=>{},h=()=>{c.current&&(c.current.canvas.style.transform=`rotate(${e.yaw}rad)`,f.current&&(f.current.canvas.style.transform=`rotate(${e.yaw}rad)`))};return m.useEffect(()=>{u.current&&!c.current?(c.current=e.mapDrawer,c.current.canvas=u.current):u.current&&c.current&&(c.current.canvas=u.current)},[u.current]),m.useEffect(()=>(e.on("updateMap",w),e.on("updateWaprs",b),()=>{e.off("updateMap",w),e.off("updateWaprs",b)}),[e]),m.useEffect(()=>()=>{},[]),r&&a!=="minimapOnly"&&(n==="singleplayer"&&t||n==="always")?C(Hi,{toggleFullMap:()=>{o==null||o({command:"ui.toggleMap"})},adapter:e,drawer:c.current,canvasRef:u}):a!=="fullmapOnly"&&(i==="singleplayer"&&t||i==="always")?O("div",{className:"minimap",style:{position:"absolute",right:"0px",top:"0px",padding:"5px 5px 0px 0px",textAlign:"center"},onClick:()=>{o==null||o({command:"ui.toggleMap"})},children:[C("canvas",{style:{transition:"0.5s",transitionTimingFunction:"ease-out",borderRadius:"1000px"},width:80,height:80,ref:u}),C("canvas",{style:{transition:"0.5s",transitionTimingFunction:"ease-out",position:"absolute",left:"0px"},width:80,height:80,ref:d}),C("canvas",{style:{transition:"0.5s",transitionTimingFunction:"ease-out",position:"absolute",left:"0px"},width:80,height:80,ref:p}),O("div",{style:{fontSize:"0.5em",textShadow:"0.1em 0 black, 0 0.1em black, -0.1em 0 black, 0 -0.1em black, -0.1em -0.1em black, -0.1em 0.1em black, 0.1em -0.1em black, 0.1em 0.1em black"},children:[v.x.toFixed(2)," ",v.y.toFixed(2)," ",v.z.toFixed(2)]})]}):null};try{Minimap.displayName="Minimap",Minimap.__docgenInfo={description:"",displayName:"Minimap",props:{adapter:{defaultValue:null,description:"",name:"adapter",required:!0,type:{name:"DrawerAdapter"}},showMinimap:{defaultValue:null,description:"",name:"showMinimap",required:!0,type:{name:"string"}},showFullmap:{defaultValue:null,description:"",name:"showFullmap",required:!0,type:{name:"string"}},singleplayer:{defaultValue:null,description:"",name:"singleplayer",required:!0,type:{name:"boolean"}},fullMap:{defaultValue:null,description:"",name:"fullMap",required:!1,type:{name:"boolean"}},toggleFullMap:{defaultValue:null,description:"",name:"toggleFullMap",required:!1,type:{name:"(({ command }: { command: string; }) => void)"}},displayMode:{defaultValue:null,description:"",name:"displayMode",required:!1,type:{name:"enum",value:[{value:'"fullmapOnly"'},{value:'"minimapOnly"'}]}}}}}catch{}const ot={component:$i,decorators:[(e,i)=>(m.useEffect(()=>{console.log("map updated"),un.emit("updateMap")},[i.args.fullMap]),O("div",{children:[" ",C(e,{})," "]}))]};class Ui extends kn{constructor(n,t){super();j(this,"playerPosition");j(this,"yaw");j(this,"warps");j(this,"chunksStore",{});j(this,"full");this.playerPosition=n??new Re(0,0,0),this.warps=t??[]}async getHighestBlockColor(n,t){return console.log("got color"),"green"}getHighestBlockY(n,t){return 0}setWarp(n,t){const r=this.warps.findIndex(o=>o.name===n.name);r===-1?this.warps.push(n):this.warps[r]=n,this.emit("updateWarps")}clearChunksStore(n,t){}async loadChunk(n){}}const un=new Ui,ne={args:{adapter:un,fullMap:!1}};var De,Ne,We;ne.parameters={...ne.parameters,docs:{...(De=ne.parameters)==null?void 0:De.docs,source:{originalSource:`{
  args: {
    adapter,
    fullMap: false
  }
}`,...(We=(Ne=ne.parameters)==null?void 0:Ne.docs)==null?void 0:We.source}}};const at=["Primary"];export{ne as Primary,at as __namedExportsOrder,ot as default};
//# sourceMappingURL=Minimap.stories-574bddeb.js.map
